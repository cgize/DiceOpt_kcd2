<!DOCTYPE html>
<html>
<head>
    <title data-i18n="title">KCD2 Dice Optimizer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="sidebar">
        <h1 data-i18n="title">KCD2 Dice Optimizer</h1>
        
        <div class="section">
            <h2 data-i18n="selected_dice">Selected Dice</h2>
            <div id="dicePool">
                <!-- Los dados seleccionados se renderizarán aquí dinámicamente -->
            </div>
            <div class="remove-hint" data-i18n="remove_hint">Click × to remove dice</div>
        </div>

        <div class="section">
            <h2>Presets</h2>
            <div class="preset-controls">
                <select id="presetSelect"></select>
                <div class="preset-buttons">
                    <button onclick="savePreset()" title="Save Preset">
                        <img src="./img/bookmark.svg" alt="Save" width="24">
                    </button>
                    <button onclick="loadPreset(presetSelect.value)" title="Load Preset">
                        <img src="./img/folder.svg" alt="Load" width="24">
                    </button>
                    <button onclick="deletePreset(presetSelect.value)" title="Delete Preset">
                        <img src="./img/trash.svg" alt="Delete" width="24">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="section">
            <h2 data-i18n="simulation">Simulation</h2>

            <!-- Barra de búsqueda con icono de lupa -->
            <div class="simulation-controls">
                <div class="dropdown-container">
                    <div class="search-box">
                        <input type="text" id="searchDice" placeholder="Search dice..." oninput="filterDice()" onclick="toggleDiceDropdown()">
                        <img src="./img/search.svg" class="search-icon" alt="Search" id="searchIcon" >
                    </div>
                    <div id="diceDropdown" class="dropdown-content"></div>
                </div>
                <button onclick="addDie()" data-i18n="add_die">Add Die</button>
                <button onclick="clearDice()" data-i18n="clear">Clear</button>
                <button onclick="startSimulation()" data-i18n="calculate">Calculate Combinations</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
        </div>

        <div id="results"></div>

        <!-- Sección de información sobre cómo se eligen las mejores combinaciones -->
        <div class="scoring-rules">
            <h3 data-i18n="how_we_choose">How do we choose the best combinations?</h3>
        </div>
    </div>

    <!-- Carga dinámica del idioma -->
    <script>
        const userLang = navigator.language || navigator.userLanguage;
        const langCode = userLang.split('-')[0];
        const lang = langCode === 'es' ? 'es' : 'en';
        document.write(`<script src="lang-${lang}.js"><\/script>`);
    </script>

    <!-- Carga de scripts esenciales -->
    <script src="diceData.js"></script>
    <script src="simulator.js"></script>

    <script>
        // Aplica traducciones a los elementos con la propiedad data-i18n
        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[key]) {
                    if (el.tagName === 'INPUT') {
                        el.placeholder = translations[key];
                    } else {
                        el.textContent = translations[key];
                    }
                }
            });

            // Traducción dinámica de la sección de combinaciones
            const scoringContainer = document.querySelector('.scoring-rules');
            if (scoringContainer) {
                scoringContainer.innerHTML = `
                    <h3>${translations.how_we_choose}</h3>
                    ${translations.simulation_steps.map(step => `
                        <div class="scoring-rule">${step}</div>
                    `).join('')}
                `;
            }

            // Actualiza la lista de presets con traducción aplicada
            const presetSelect = document.getElementById('presetSelect');
            if (presetSelect) {
                presetSelect.innerHTML = `<option value="">${translations.select_preset}</option>`;
            }
        }

        // Inicialización de la página
        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            updatePresetSelector();
        });
    </script>
</body>
</html>
